name: Build NET X APK
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: Create Project Files
        run: |
          mkdir -p app/src/main/java/com/turbo/net
          mkdir -p app/src/main/res/values
          mkdir -p app/src/main/res/mipmap-xhdpi

          # 1. Ù…Ù„Ù Ø§Ù„Ø®ØµØ§Ø¦Øµ
          echo "android.useAndroidX=true" > gradle.properties
          echo "android.enableJetifier=true" >> gradle.properties

          # 2. Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª (ØµÙ„Ø­Øª Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù€ Missing name)
          printf '<manifest xmlns:android="http://schemas.microsoft.com/apk/res/android">\n    <uses-permission android:name="android.permission.INTERNET" />\n    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />\n    <application android:label="NET X ğŸš€" android:theme="@style/Theme.AppCompat.NoActionBar">\n        <activity android:name="com.turbo.net.MainActivity" android:exported="true">\n            <intent-filter>\n                <action android:name="android.intent.action.MAIN" />\n                <category android:name="android.intent.category.LAUNCHER" />\n            </intent-filter>\n        </activity>\n        <service android:name="com.turbo.net.NetBoosterService" android:permission="android.permission.BIND_VPN_SERVICE" android:exported="false" />\n    </application>\n</manifest>' > app/src/main/AndroidManifest.xml

          # 3. ÙƒÙˆØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          printf 'package com.turbo.net\nimport android.content.*\nimport android.graphics.Color\nimport android.net.VpnService\nimport android.os.*\nimport android.view.Gravity\nimport android.widget.*\nimport androidx.appcompat.app.AppCompatActivity\nimport java.util.*\n\nclass MainActivity : AppCompatActivity() {\n    private var savedMB = 0.0\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val root = LinearLayout(this).apply {\n            orientation = LinearLayout.VERTICAL\n            backgroundColor = Color.parseColor("#0F0F0F")\n            gravity = Gravity.CENTER\n            setPadding(60, 60, 60, 60)\n        }\n        val title = TextView(this).apply { text = "NET X"; setTextColor(Color.CYAN); textSize = 40f }\n        val savings = TextView(this).apply { text = "0.00 MB"; setTextColor(Color.GREEN); textSize = 25f }\n        val btn = Button(this).apply { text = "START TURBO"; setBackgroundColor(Color.CYAN) }\n        root.addView(title); root.addView(savings); root.addView(btn)\n        setContentView(root)\n        btn.setOnClickListener {\n            val vpnIntent = VpnService.prepare(this)\n            if (vpnIntent != null) startActivityForResult(vpnIntent, 0) else startTurbo(savings)\n        }\n    }\n    private fun startTurbo(v: TextView) {\n        startService(Intent(this, NetBoosterService::class.java))\n        Timer().schedule(object : TimerTask() {\n            override fun run() { runOnUiThread { savedMB += 0.1; v.text = "%.2f".format(savedMB) + " MB SAVED" } }\n        }, 0, 1000)\n    }\n}\nclass NetBoosterService : VpnService() {\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        Builder().addAddress("10.0.0.2", 32).addRoute("0.0.0.0", 0).establish()\n        return START_STICKY\n    }\n}' > app/src/main/java/com/turbo/net/MainActivity.kt

          # 4. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Gradle
          echo "include ':app'" > settings.gradle
          printf "buildscript {\n    repositories { google(); mavenCentral() }\n    dependencies { classpath 'com.android.tools.build:gradle:7.4.2'\n                   classpath 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.8.10' }\n}\nallprojects { repositories { google(); mavenCentral() } }" > build.gradle
          printf "plugins { id 'com.android.application'; id 'kotlin-android' }\nandroid {\n    namespace 'com.turbo.net'\n    compileSdk 33\n    defaultConfig { applicationId 'com.turbo.net'; minSdk 21; targetSdk 33; versionCode 1; versionName '1.0' }\n}\ndependencies {\n    implementation 'androidx.appcompat:appcompat:1.6.1'\n    implementation 'androidx.core:core-ktx:1.9.0'\n}" > app/build.gradle

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: 7.5

      - name: Build APK
        run: gradle assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: NET-X-Ready
          path: app/build/outputs/apk/debug/*.apk
