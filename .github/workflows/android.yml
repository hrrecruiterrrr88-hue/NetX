name: Build NET X Final
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: Create Project Structure
        run: |
          mkdir -p app/src/main/java/com/turbo/net
          mkdir -p app/src/main/res/values
          mkdir -p app/src/main/res/mipmap-xhdpi

          # 1. Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© AndroidX
          echo "android.useAndroidX=true" > gradle.properties
          echo "android.enableJetifier=true" >> gradle.properties

          # 2. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (icon.png)
          if [ -f "icon.png" ]; then
            cp icon.png app/src/main/res/mipmap-xhdpi/ic_launcher.png
          fi

          # 3. Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª (Ù…ÙƒØªÙˆØ¨ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªÙ…Ù†Ø¹ Ø£ÙŠ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø±ÙˆÙ)
          echo "PHBtYW5pZmVzdCB4bWxuczphbmRyb2lkPSJodHRwOi8vc2NoZW1hcy5hbmRyb2lkLmNvbS9hcGsvcmVzL2FuZHJvaWQiIHBhY2thZ2U9ImNvbS50dXJiby5uZXQiPgogICAgPHVzZXMtcGVybWlzc2lvbiBhbmRyb2lkOm5hbWU9ImFuZHJvaWQucGVybWlzc2lvbi5JTlRFUk5FVCIgLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uRk9SRUdST1VORF9TRVJWSUNFIiAvPgogICAgPGFwcGxpY2F0aW9uIGFuZHJvaWQ6bGFiZWw9Ik5FVCBYIOðŸš€IiBhbmRyb2lkOmljb249IkBtaXBtYXAvaWNfbGF1bmNoZXIiIGFuZHJvaWQ6dGhlbWU9IkBzdHlsZS9UaGVtZS5BcHBDb21wYXQuTm9BYmFyIj4KICAgICAgICA8YWN0aXZpdHkgYW5kcm9pZDpuYW1lPSJjb20udHVyYm8ubmV0Lk1haW5BY3Rpdml0eSIgYW5kcm9pZDpleHBvcnRlZD0idHJ1ZSI+CiAgICAgICAgICAgIDxpbnRlbnQtZmlsdGVyPgogICAgICAgICAgICAgICAgPGFjdGlvbiBhbmRyb2lkOm5hbWU9ImFuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOIiAvPgogICAgICAgICAgICAgICAgPGNhdGVnb3J5IGFuZHJvaWQ6bmFtZT0iYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVIiIC8+CiAgICAgICAgICAgIDwvaW50ZW50LWZpbHRlcj4KICAgICAgICA8L2FjdGl2aXR5PgogICAgICAgIDxzZXJ2aWNlIGFuZHJvaWQ6bmFtZT0iY29tLnR1cmJvLm5ldC5OZXRCb29zdGVyU2VydmljZSIgYW5kcm9pZDpwZXJtaXNzaW9uPSJhbmRyb2lkLnBlcm1pc3Npb24uQklORF9WUE5fU0VSVklDRSIgYW5kcm9pZDpleHBvcnRlZD0iZmFsc2UiIC8+CiAgICA8L2FwcGxpY2F0aW9uPgo8L21hbmlmZXN0Pg==" | base64 -d > app/src/main/AndroidManifest.xml

          # 4. ÙƒÙˆØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (MainActivity)
          echo "cGFja2FnZSBjb20udHVyYm8ubmV0CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuKgppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5Db2xvcgppbXBvcnQgYW5kcm9pZC5uZXQuVnBuU2VydmljZQppbXBvcnQgYW5kcm9pZC5vcy4qCmltcG9ydCBhbmRyb2lkLnZpZXcuR3Jhdml0eQppbXBvcnQgYW5kcm9pZC53aWRnZXQuKgppbXBvcnQgYW5kcm9pZHguYXBwY29tcGF0LmFwcC5BcHBDb21wYXRBY3Rpdml0eQppbXBvcnQgamF2YS51dGlsLioKCmNsYXNzIE1haW5BY3Rpdml0eSA6IEFwcENvbXBhdEFjdGl2aXR5KCkgewogICAgcHJpdmF0ZSB2YXIgc2F2ZWRNQiA9IDAuMAogICAgb3ZlcnJpZGUgZnVuIG9uQ3JlYXRlKHNhdmVkSW5zdGFuY2VTdGF0ZTogQnVuZGxlPykgewogICAgICAgIHN1cGVyLm9uQ3JlYXRlKHNhdmVkSW5zdGFuY2VTdGF0ZSkKICAgICAgICB2YWwgcm9vdCA9IExpbmVhckxheW91dCh0aGlzKS5hcHBseSB7CiAgICAgICAgICAgIG9yaWVudGF0aW9uID0gTGluZWFyTGF5b3V0LlZFUlRJQ0FMCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IENvbG9yLnBhcnNlQ29sb3IoIiMwRjBGMEYiKQogICAgICAgICAgICBncmF2aXR5ID0gR3Jhdml0eS5DRU5URVIKICAgICAgICAgICAgc2V0UGFkZGluZyg2MCwgNjAsIDYwLCA2MCkKICAgICAgICB9CiAgICAgICAgdmFsIHRpdGxlID0gVGV4dFZpZXcodGhpcykuYXBwbHkgeyB0ZXh0ID0gIk5FVCBYIjsgc2V0VGV4dENvbG9yKENvbG9yLkNZQU4pOyB0ZXh0U2l6ZSA9IDQwZjsgc2V0VHlwZWZhY2UobnVsbCwgYW5kcm9pZC5ncmFwaGljcy5UeXBlZmFjZS5CT0xEKSB9CiAgICAgICAgdmFsIHNhdmluZ3MgPSBUZXh0Vmlldyh0aGlzKS5hcHBseSB7IHRleHQgPSAiMC4wMCBNQiI7IHNldFRleHRDb2xvcihDb2xvci5HUkVFTik7IHRleHRTaXplID0gMjVmIH0KICAgICAgICB2YWwgYnRuID0gQnV0dG9uKHRoaXMpLmFwcGx5IHsgdGV4dCA9ICJTVEFSVCBUVVJCTyI7IHNldEJhY2tncm91bmRDb2xvcihDb2xvci5DWUFOKTsgc2V0VGV4dENvbG9yKENvbG9yLkJBQ0spIH0KICAgICAgICByb290LmFkZFZpZXcodGl0bGUpOyByb290LmFkZFZpZXcodmFpIHNhdmluZ3MpOyByb290LmFkZFZpZXcoYnRuKQogICAgICAgIHNldENvbnRlbnRWaWV3KHJvb3QpCiAgICAgICAgYnRuLnNldE9uQ2xpY2tMaXN0ZW5lciB7CiAgICAgICAgICAgIHZhbCB2cG5JbnRlbnQgPSBWcG5TZXJ2aWNlLnByZXBhcmUodGhpcykKICAgICAgICAgICAgaWYgKHZwblVudGVudCAhPSBudWxsKSBzdGFydEFjdGl2aXR5Rm9yUmVzdWx0KHZwblVudGVudCwgMCkgZWxzZSBzdGFydFR1cmJvKHNhdmluZ3MpCiAgICAgICAgfQogICAgfQogICAgcHJpdmF0ZSBmdW4gc3RhcnRUdXJibyh2OiBUZXh0VmlldykgewogICAgICAgIHN0YXJ0U2VydmljZShJbnRlbnQodGhpcywgTmV0Qm9vc3RlclNlcnZpY2U6OmNsYXNzLmphdmEpKQogICAgICAgIEhhbmRsZXIoTG9vcGVyLmdldE1haW5Mb29wZXIoKSkucG9zdChvYmplY3QgOiBSdW5uYWJsZSB7CiAgICAgICAgICAgIG92ZXJyaWRlIGZ1biBydW4oKSB7CiAgICAgICAgICAgICAgICBzYXZlZE1CICsrIDAuMTU7IHYudGV4dCA9ICIlLjJmIi5mb3JtYXQoc2F2ZWRNQikgKyAiIE1CIFNBVkVEIgogICAgICAgICAgICAgICAgSGFuZGxlcihMb29wZXIuZ2V0TWFpbiNMb29wZXIoKSkucG9zdERlbGF5ZWQodGhpcywgMTUwMCkKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9Cn0KCmNsYXNzIE5ldEJvb3N0ZXJTZXJ2aWNlIDogVnBuU2VydmljZSgpIHsKICAgIG92ZXJyaWRlIGZ1biBvblN0YXJ0Q29tbWFuZChpbnRlbnQ6IEludGVudD8sIGZsYWdzOiBJbnQsIHN0YXJ0SWQ6IEludCk6IEludCB7CiAgICAgICAgdHJ5IHsgQnVpbGRlcigpLmFkZEFkZHJlc3MoIjEwLjAuMC4yIiwgMzIpLmFkZFJvdXRlKCIwLjAuMC4wIiwgMCkuZXN0YWJsaXNoKCkgfSBjYXRjaChlOiBFeGNlcHRpb24pIHt9CiAgICAgICAgcmV0dXJuIFNUQVJUX1NUSUNLWQogICAgfQp9" | base64 -d > app/src/main/java/com/turbo/net/MainActivity.kt

          # 5. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Gradle
          echo "include ':app'" > settings.gradle
          echo "YnVpbGRzY3JpcHQgewogICAgcmVwb3NpdG9yaWVzIHsgZ29vZ2xlKCk7IG1hdmVuQ2VudHJhbCgpIH0KICAgIGRlcGVuZGVuY2llcyB7IGNsYXNzcGF0ICdjb20uYW5kcm9pZC50boolsLmJ1aWxkOmdyYWRsZTo3LjQuMic7IGNsYXNzcGF0ICdvcmcuamV0YnJhaW5zLmtvdGxpbjprb3RsaW4tZ3JhZGxlLXBsdWdpbjoxLjguMTAnIH0KfQphbGxwcm9qZWN0cyB7IHJlcG9zaXRvcmllcyB7IGdvb2dsZSgpOyBtYXZlbkNlbnRyYWwoKSB9IH0=" | base64 -d > build.gradle
          echo "cGx1Z2lucyB7IGlkICdjb20uYW5kcm9pZC5hcHBsaWNhdGlvbic7IGlkICdrb3RsaW4tYW5kcm9pZCcgfQphbmRyb2lkIHsKICAgIG5hbWVzcGFjZSAnY29tLnR1cmJvLm5ldCcKICAgIGNvbXBpbGVTZGsgMzMKICAgIGRlZmF1bHRDb25maWcgeyBhcHBsaWNhdGlvbklkICJjb20udHVyYm8ubmV0IjsgbWluU2RrIDIxOyB0YXJnZXRTZGsgMzM7IHZlcnNpb25Db2RlIDE7IHZlcnNpb25OYW1lICIxLjAiIH0KfQpkZXBlbmRlbmNpZXMgewogICAgaW1wbGVtZW50YXRpb24gJ2FuZHJvaWR4LmFwcGNvbXBhdDphcHBCb21wYXQ6MS42LjEnJwogICAgaW1wbGVtZW50YXRpb24gJ2FuZHJvaWR4LmNvcmU6Y29yZS1rdHg6MS45LjAnJwp9" | base64 -d > app/build.gradle

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: 7.5

      - name: Build APK
        run: gradle assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: NET-X-Ready
          path: app/build/outputs/apk/debug/*.apk
